services:
  mtproxy:
    platform: linux/amd64
    build: 
      context: ..
      dockerfile: Dockerfile
    ports:
      - "18443:8443"
      - "18888:8888"
    ulimits:
      nofile:
        soft: 65536
        hard: 65536
    environment:
      - SECRET=${MTPROXY_SECRET}
      - PORT=8443
      - WORKERS=1
  tester:
    build: .
    environment:
      - MTPROXY_HOST=mtproxy
      - MTPROXY_PORT=8443
      - MTPROXY_STATS_PORT=8888
    depends_on:
      - mtproxy